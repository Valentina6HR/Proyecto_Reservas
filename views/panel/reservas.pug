extends ../layout/admin

block contenido
    .admin-panel-container.flex.min-h-screen.bg-crema
        
        //- Overlay para cerrar sidebar en móvil
        #sidebar-overlay.sidebar-overlay.hidden
        
        //- Botón hamburguesa para móviles (derecha)
        button#sidebar-toggle.sidebar-toggle.bg-vino.text-dorado.p-3.rounded-full.shadow-xl(class="lg:hidden")
            svg(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16")
        
        //- Sidebar izquierdo
        aside#sidebar.admin-sidebar.bg-vino.text-crema.flex.flex-col.shadow-2xl
            // Logo y título
            .sidebar-header.p-6.border-b-2.border-dorado
                h2.text-2xl.font-serif.font-bold.text-dorado Panel de Control
                p.text-sm.mt-2.opacity-90 #{usuario.nombre}
                p.text-xs.opacity-70.capitalize #{usuario.rol}
            
            //- Navegación
            nav.sidebar-nav.flex-1.p-4.space-y-2
                // Dashboard
                a.nav-item(href="/panel/admin")
                    svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                        path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6")
                    span Dashboard
                
                //- Reservas
                a.nav-item.active(href="/admin/reservas")
                    svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                        path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z")
                    span Gestionar Reservas
                
                //- Mesas (no para meseros)
                if usuario.rol !== "mesero"
                    a.nav-item(href="/mesas")
                        svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z")
                        span Gestión de Mesas
                
                //- Usuarios (solo admin)
                if usuario.rol === "admin"
                    a.nav-item(href="/admin/usuarios")
                        svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z")
                        span Usuarios del Sistema

                //- Reportes (solo admin)
                if usuario.rol === "admin"
                    a.nav-item(href="/admin/reportes")
                        svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                            path(path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m2 10V7m2 10V7m2 10h2a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2h2m4 2v2m3-2v2M9 13h3")
                        span Reportes

                //- Configuración (solo admin)
                if usuario.rol === "admin"
                    a.nav-item(href="/config")
                        svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z")
                            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z")
                        span Configuración
                
                //- Pagina principal
                a.nav-item(href="/")
                    svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                        path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7")
                    span Regresar a Inicio
            
            //- Footer del sidebar
            .sidebar-footer.p-4.border-t-2.border-dorado
                a.nav-item.logout(href="/auth/cerrar-sesion")
                    svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                        path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1")
                    span Cerrar Sesión
        
        //- Contenido principal
        main.admin-content.flex-1.p-8
            //- Encabezado
            .mb-8.flex.justify-between.items-center
                div
                    h1.text-4xl.font-serif.text-vino.font-bold.mb-2 Gestión de Reservas
                    p.text-lg.text-gray-700 Listado completo de reservas realizadas
            
            //- Vista de tarjetas para móvil
            .mobile-cards-container.block(class="md:hidden")
                if reservas.length
                    .grid.gap-4
                        each reserva in reservas
                            .reservation-card.bg-white.rounded-xl.shadow-lg.p-4.border-l-4(
                                class=reserva.estado === 'confirmada' ? 'border-green-500' : reserva.estado === 'pendiente' ? 'border-yellow-500' : reserva.estado === 'cancelada' ? 'border-red-500' : reserva.estado === 'en_curso' ? 'border-blue-500' : reserva.estado === 'completada' ? 'border-gray-500' : 'border-orange-500'
                            )
                                //- Header de la tarjeta
                                .flex.justify-between.items-start.mb-3
                                    .flex.items-center.gap-3
                                        .w-10.h-10.rounded-lg.bg-gradient-to-br.from-vino.to-red-800.flex.items-center.justify-center.shadow-md
                                            span.text-white.font-bold.text-xs ##{reserva.id_reserva}
                                        div
                                            //- Mostrar datos del formulario, con fallback a datos del usuario
                                            if reserva.nombre_cliente
                                                h3.font-bold.text-gray-900.text-sm #{reserva.nombre_cliente}
                                                p.text-xs.text-gray-500 #{reserva.email_cliente || (reserva.usuario ? reserva.usuario.email : '')}
                                            else if reserva.usuario
                                                h3.font-bold.text-gray-900.text-sm #{reserva.usuario.nombre}
                                                p.text-xs.text-gray-500 #{reserva.usuario.email}
                                            else
                                                h3.font-bold.text-gray-400.text-sm Usuario no encontrado
                                    //- Estado badge
                                    form.estado-form(action=`/admin/reservas/${reserva.id_reserva}/estado` method="POST")
                                        input(type="hidden" name="_csrf" value=csrfToken)
                                        select.estado-select-mobile.text-xs.font-semibold.rounded-lg.px-2.py-1.cursor-pointer(name="estado" onchange="this.form.submit()")
                                            option(value="pendiente" selected=(reserva.estado === "pendiente")) Pendiente
                                            option(value="confirmada" selected=(reserva.estado === "confirmada")) Confirmada
                                            option(value="en_curso" selected=(reserva.estado === "en_curso")) En Curso
                                            option(value="completada" selected=(reserva.estado === "completada")) Completada
                                            option(value="cancelada" selected=(reserva.estado === "cancelada")) Cancelada
                                            option(value="no_show" selected=(reserva.estado === "no_show")) No Show
                                
                                //- Información de la reserva
                                .grid.grid-cols-2.gap-3.text-sm.mb-3
                                    .flex.items-center.gap-2
                                        svg.w-4.h-4.text-vino(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                                            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z")
                                        span.text-gray-700 #{reserva.fecha_reserva}
                                    .flex.items-center.gap-2
                                        svg.w-4.h-4.text-vino(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                                            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z")
                                        span.text-gray-700 #{reserva.hora_inicio}
                                    .flex.items-center.gap-2
                                        svg.w-4.h-4.text-vino(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                                            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z")
                                        span.text-gray-700 #{reserva.numero_personas} personas
                                    .flex.items-center.gap-2
                                        if reserva.mesa
                                            svg.w-4.h-4.text-vino(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                                                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z")
                                            span.text-gray-700.font-semibold #{reserva.mesa.nombre}
                                        else
                                            span.text-orange-500.text-xs Sin mesa
                                
                                //- Observaciones (si existen)
                                if reserva.observaciones
                                    - let obsTexto = reserva.observaciones.split('| Mesa asignada')[0].trim()
                                    if obsTexto && !obsTexto.startsWith('Mesa asignada:')
                                        .bg-gray-50.rounded-lg.p-2.mb-3
                                            .flex.items-start.gap-2
                                                span.text-gray-500.text-xs Obs:
                                                p.text-xs.text-gray-600.line-clamp-2= obsTexto
                                
                                //- Acciones
                                .flex.gap-2.pt-2.border-t.border-gray-100
                                    button.flex-1.bg-blue-500.hover_bg-blue-600.text-white.px-3.py-2.rounded-lg.text-xs.font-semibold.transition-colors(
                                        type="button"
                                        onclick=`abrirModalReagendar(${reserva.id_reserva}, '${reserva.fecha_reserva}', '${reserva.hora_inicio}', '${reserva.nombre_cliente || (reserva.usuario ? reserva.usuario.nombre : "Cliente")}')`
                                    )
                                        | Reagendar
                                    button.flex-1.bg-red-500.hover_bg-red-600.text-white.px-3.py-2.rounded-lg.text-xs.font-semibold.transition-colors(
                                        type="button"
                                        onclick=`confirmarEliminar(${reserva.id_reserva})`
                                    )
                                        | Eliminar
                else
                    .text-center.py-8.text-gray-500 No hay reservas registradas

            //- Contenedor de la tabla (solo desktop)
            .bg-white.rounded-xl.shadow-xl.overflow-hidden.hidden(class="md:block")
                .overflow-x-auto
                    table.min-w-full.divide-y.divide-gray-200
                        thead.bg-gradient-vino.text-dorado
                            tr
                                th.px-6.py-4.text-left.text-xs.font-bold.uppercase.tracking-wider ID
                                th.px-6.py-4.text-left.text-xs.font-bold.uppercase.tracking-wider Cliente
                                th.px-6.py-4.text-left.text-xs.font-bold.uppercase.tracking-wider Mesa Asignada
                                th.px-6.py-4.text-left.text-xs.font-bold.uppercase.tracking-wider Fecha y Hora
                                th.px-6.py-4.text-left.text-xs.font-bold.uppercase.tracking-wider Personas
                                th.px-6.py-4.text-left.text-xs.font-bold.uppercase.tracking-wider Observaciones
                                th.px-6.py-4.text-left.text-xs.font-bold.uppercase.tracking-wider Estado
                                th.px-6.py-4.text-left.text-xs.font-bold.uppercase.tracking-wider Acciones
                        
                        tbody.bg-white.divide-y.divide-gray-200
                            if reservas.length
                                each reserva in reservas
                                    tr.hover_bg-gray-50.transition-colors
                                        td.px-6.py-4.whitespace-nowrap.text-sm.font-medium.text-gray-900 ##{reserva.id_reserva}
                                        
                                        td.px-6.py-4.whitespace-nowrap
                                            //- Mostrar datos del formulario, con fallback a datos del usuario
                                            if reserva.nombre_cliente
                                                .flex.items-center
                                                    .ml-0
                                                        .text-sm.font-medium.text-gray-900 #{reserva.nombre_cliente}
                                                        .text-sm.text-gray-500 #{reserva.email_cliente || (reserva.usuario ? reserva.usuario.email : '')}
                                                        if reserva.telefono_cliente
                                                            .text-xs.text-gray-400 #{reserva.telefono_cliente}
                                                        else if reserva.usuario && reserva.usuario.telefono
                                                            .text-xs.text-gray-400 #{reserva.usuario.telefono}
                                            else if reserva.usuario
                                                .flex.items-center
                                                    .ml-0
                                                        .text-sm.font-medium.text-gray-900 #{reserva.usuario.nombre}
                                                        .text-sm.text-gray-500 #{reserva.usuario.email}
                                                        if reserva.usuario.telefono
                                                            .text-xs.text-gray-400 #{reserva.usuario.telefono}
                                            else
                                                span.text-xs.text-gray-500 Usuario no encontrado
                                        
                                        td.px-6.py-4.whitespace-nowrap
                                            if reserva.mesa
                                                .flex.items-center.gap-2
                                                    .w-8.h-8.rounded-lg.bg-gradient-to-br.from-vino.to-red-800.flex.items-center.justify-center.shadow-md
                                                        span.text-white.text-xs.font-bold #{reserva.mesa.id}
                                                    div
                                                        .text-sm.font-semibold.text-vino #{reserva.mesa.nombre}
                                                        .text-xs.text-gray-500
                                                            if reserva.mesa.zona
                                                                span.capitalize #{reserva.mesa.zona}
                                                                span.mx-1 •
                                                            span Cap: #{reserva.mesa.capacidad}
                                            else
                                                .flex.items-center.gap-2
                                                    .w-8.h-8.rounded-lg.bg-gray-200.flex.items-center.justify-center
                                                        span.text-gray-400.text-lg ?
                                                    div
                                                        .text-sm.font-medium.text-gray-400 Sin asignar
                                                        .text-xs.text-orange-500 Pendiente
                                        
                                        td.px-6.py-4.whitespace-nowrap
                                            .text-sm.text-gray-900 #{reserva.fecha_reserva}
                                            .text-sm.text-gray-500 #{reserva.hora_inicio} - #{reserva.hora_fin}
                                        
                                        td.px-6.py-4.whitespace-nowrap.text-sm.text-gray-500
                                            span.px-2.inline-flex.text-xs.leading-5.font-semibold.rounded-full.bg-gray-100.text-gray-800 #{reserva.numero_personas} Pers.
                                        
                                        td.px-4.py-4.text-sm
                                            if reserva.observaciones
                                                .observaciones-cell
                                                    .observaciones-icons.flex.gap-1.mb-1
                                                        if reserva.observaciones.toLowerCase().includes('cumpleaños') || reserva.observaciones.toLowerCase().includes('cumpleanos')
                                                            span.obs-badge.obs-cumple.text-xs.bg-pink-100.text-pink-600.px-1.rounded(title="Cumpleaños") Cumple
                                                        if reserva.observaciones.toLowerCase().includes('alergia')
                                                            span.obs-badge.obs-alergia.text-xs.bg-red-100.text-red-600.px-1.rounded(title="Alergias") Alergia
                                                        if reserva.observaciones.toLowerCase().includes('vegetariano') || reserva.observaciones.toLowerCase().includes('vegano')
                                                            span.obs-badge.obs-dieta.text-xs.bg-green-100.text-green-600.px-1.rounded(title="Dieta especial") Dieta
                                                        if reserva.observaciones.toLowerCase().includes('niño') || reserva.observaciones.toLowerCase().includes('bebé') || reserva.observaciones.toLowerCase().includes('infantil')
                                                            span.obs-badge.obs-ninos.text-xs.bg-blue-100.text-blue-600.px-1.rounded(title="Con niños") Niños
                                                    
                                                    - let obsTexto = reserva.observaciones.split('| Mesa asignada')[0].trim()
                                                    if obsTexto === '' || obsTexto.startsWith('Mesa asignada:') 
                                                        span.text-gray-400.text-xs -
                                                    else
                                                        .observaciones-text.text-xs.text-gray-600.max-w-xs.truncate(title=obsTexto)
                                                            = obsTexto.length > 50 ? obsTexto.substring(0, 50) + '...' : obsTexto
                                                        if obsTexto.length > 50
                                                            button.text-xs.text-vino.underline.mt-1(type="button" onclick=`mostrarObservaciones('${obsTexto.replace(/'/g, "\\'")}')`) Ver más
                                            else
                                                span.text-gray-400.text-xs Sin observaciones
                                        
                                        td.px-6.py-4.whitespace-nowrap
                                            form.estado-form(action=`/admin/reservas/${reserva.id_reserva}/estado` method="POST")
                                                input(type="hidden" name="_csrf" value=csrfToken)
                                                select.estado-select.text-xs.font-semibold.rounded-lg.px-2.py-1.cursor-pointer(name="estado" onchange="this.form.submit()")
                                                
                                                    option(value="pendiente" selected=(reserva.estado === "pendiente")) Pendiente
                                                    option(value="confirmada" selected=(reserva.estado === "confirmada")) Confirmada
                                                    option(value="en_curso" selected=(reserva.estado === "en_curso")) En Curso
                                                    option(value="completada" selected=(reserva.estado === "completada")) Completada
                                                    option(value="cancelada" selected=(reserva.estado === "cancelada")) Cancelada
                                                    option(value="no_show" selected=(reserva.estado === "no_show")) No Show
                                        
                                        td.px-6.py-4.whitespace-nowrap.text-sm.font-medium
                                            .flex.gap-2.flex-wrap
                                                button.btn-reagendar.bg-blue-500.hover_bg-blue-600.text-white.px-3.py-1.rounded-lg.text-xs.font-semibold.transition-colors(
                                                    type="button"
                                                    onclick=`abrirModalReagendar(${reserva.id_reserva}, '${reserva.fecha_reserva}', '${reserva.hora_inicio}', '${reserva.nombre_cliente || (reserva.usuario ? reserva.usuario.nombre : "Cliente")}')`
                                                    title="Reagendar reserva"
                                                )
                                                    | Reagendar
                                                button.btn-eliminar.bg-red-500.hover_bg-red-600.text-white.px-3.py-1.rounded-lg.text-xs.font-semibold.transition-colors(
                                                    type="button"
                                                    onclick=`confirmarEliminar(${reserva.id_reserva})`
                                                )
                                                    | Eliminar
                            else
                                tr
                                    td.px-6.py-4.whitespace-nowrap.text-center.text-gray-500(colspan="8") No hay reservas registradas

    //- Modal de confirmación
    #modal-eliminar.modal-overlay.hidden
        .modal-content
            .modal-header
                h3.text-xl.font-bold.text-vino ¿Eliminar Reserva?
            .modal-body
                p.text-gray-600 Esta acción no se puede deshacer. ¿Estás seguro de que deseas eliminar esta reserva?
            .modal-footer
                button#btn-cancelar.bg-gray-300.hover_bg-gray-400.text-gray-800.px-4.py-2.rounded-lg.font-semibold.mr-2 Cancelar
                form#form-eliminar(method="POST" style="display:inline")
                    input(type="hidden" name="_csrf" value=csrfToken)
                    button.bg-red-500.hover_bg-red-600.text-white.px-4.py-2.rounded-lg.font-semibold(type="submit") Eliminar

    //- Modal de reagendar
    #modal-reagendar.modal-overlay.hidden
        .modal-content.modal-reagendar
            .modal-header
                h3.text-xl.font-bold.text-vino Reagendar Reserva
                p#reagendar-cliente.text-sm.text-gray-500.mt-1 Cliente: 
            .modal-body
                form#form-reagendar(method="POST")
                    input(type="hidden" name="_csrf" value=csrfToken)
                    
                    .mb-4
                        label.block.text-sm.font-semibold.text-gray-700.mb-2(for="nueva_fecha") Nueva Fecha
                        input#nueva_fecha.w-full.px-4.py-2.border-2.border-gray-200.rounded-lg.focus_border-vino.focus_outline-none.transition-colors(
                            type="date"
                            name="fecha_reserva"
                            required
                        )
                    
                    .mb-4
                        label.block.text-sm.font-semibold.text-gray-700.mb-2(for="nueva_hora") Nueva Hora
                        input#nueva_hora.w-full.px-4.py-2.border-2.border-gray-200.rounded-lg.focus_border-vino.focus_outline-none.transition-colors(
                            type="time"
                            name="hora_inicio"
                            required
                        )
                    
                    .mb-4
                        label.block.text-sm.font-semibold.text-gray-700.mb-2(for="motivo") Motivo del reagendamiento
                        textarea#motivo.w-full.px-4.py-2.border-2.border-gray-200.rounded-lg.focus_border-vino.focus_outline-none.transition-colors(
                            name="motivo_reagendamiento"
                            rows="3"
                            placeholder="Ej: Solicitud del cliente, cambio de disponibilidad..."
                        )
                    
                    .info-notificacion.bg-blue-50.border-l-4.border-blue-500.p-3.rounded.mb-4
                        p.text-xs.text-blue-700
                            strong Nota: 
                            | Se notificará al cliente sobre el cambio de su reserva.
                    
                    .modal-footer
                        button#btn-cancelar-reagendar.bg-gray-300.hover_bg-gray-400.text-gray-800.px-4.py-2.rounded-lg.font-semibold.mr-2(type="button") Cancelar
                        button.bg-blue-500.hover_bg-blue-600.text-white.px-4.py-2.rounded-lg.font-semibold(type="submit") 
                            | Confirmar Reagendamiento

    //- Modal para ver observaciones completas
    #modal-observaciones.modal-overlay.hidden
        .modal-content
            .modal-header
                h3.text-xl.font-bold.text-vino Observaciones
            .modal-body
                p#observaciones-texto.text-gray-600.whitespace-pre-wrap
            .modal-footer
                button#btn-cerrar-obs.bg-vino.hover_bg-red-800.text-white.px-4.py-2.rounded-lg.font-semibold Cerrar

    style.
        /* Estilos base */
        .admin-panel-container { margin: 0; min-height: 100vh; }
        .admin-sidebar { width: 280px; position: fixed; left: 0; top: 0; height: 100vh; overflow-y: auto; z-index: 200; transform: translateX(-100%); transition: transform 0.3s ease; }
        .admin-sidebar.open { transform: translateX(0); }
        .sidebar-header { background: linear-gradient(135deg, #6E1825 0%, #8B2030 100%); }
        .nav-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; border-radius: 0.5rem; color: #F2EADF; font-weight: 500; transition: all 0.3s ease; cursor: pointer; }
        .nav-item:hover { background: rgba(199, 168, 108, 0.15); transform: translateX(4px); color: #C7A86C; }
        .nav-item.active { background: linear-gradient(90deg, rgba(199, 168, 108, 0.2) 0%, rgba(199, 168, 108, 0.05) 100%); border-left: 3px solid #C7A86C; color: #C7A86C; }
        .nav-icon { width: 1.5rem; height: 1.5rem; flex-shrink: 0; }
        .admin-content { margin-left: 0; min-height: 100vh; padding-top: 4rem; }
        .bg-gradient-vino { background: linear-gradient(135deg, #6E1825 0%, #8B2030 100%); }
        .sidebar-toggle { 
            position: fixed; 
            top: 1rem; 
            right: 1rem; 
            z-index: 150; 
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .sidebar-toggle.hidden { 
            opacity: 0; 
            pointer-events: none; 
            transform: scale(0.8);
        }
        
        /* Overlay para cerrar sidebar */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 150;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        .sidebar-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        .sidebar-overlay.hidden { display: none; }
        
        /* Select de estado */
        .estado-select {
            border: 2px solid #e5e7eb;
            background-color: white;
            transition: all 0.2s ease;
        }
        .estado-select:hover {
            border-color: #C7A86C;
        }
        .estado-select:focus {
            outline: none;
            border-color: #6E1825;
            box-shadow: 0 0 0 3px rgba(110, 24, 37, 0.1);
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-overlay.hidden { display: none; }
        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s ease;
        }
        .modal-reagendar {
            max-width: 500px;
        }
        .modal-header { margin-bottom: 1rem; }
        .modal-body { margin-bottom: 1.5rem; }
        .modal-footer { display: flex; justify-content: flex-end; }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Estilos para observaciones */
        .observaciones-cell {
            min-width: 150px;
            max-width: 250px;
        }
        .obs-badge {
            display: inline-flex;
            font-size: 1rem;
            cursor: help;
            transition: transform 0.2s;
        }
        .obs-badge:hover {
            transform: scale(1.2);
        }
        .observaciones-text {
            line-height: 1.4;
        }
        
        /* Estilos para botón reagendar */
        .btn-reagendar {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
        }
        .btn-reagendar:hover {
            background: linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%);
            transform: translateY(-1px);
        }
        
        /* Focus styles para formulario */
        .focus_border-vino:focus {
            border-color: #6E1825 !important;
        }
        
        @media (min-width: 769px) {
            .admin-sidebar { transform: translateX(0); }
            .admin-content { margin-left: 280px; padding-top: 0; }
            .sidebar-toggle { display: none; }
            .sidebar-overlay { display: none; }
        }
        
        /* Tarjetas de reserva en móvil */
        .reservation-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .reservation-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .estado-select-mobile {
            border: 2px solid #e5e7eb;
            background-color: white;
            transition: all 0.2s ease;
        }

    script.
        // Toggle sidebar en móviles
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        
        function openSidebar() {
            sidebar.classList.add('open');
            sidebarOverlay.classList.remove('hidden');
            sidebarOverlay.classList.add('active');
            sidebarToggle.classList.add('hidden');
        }
        
        function closeSidebar() {
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('active');
            setTimeout(() => sidebarOverlay.classList.add('hidden'), 300);
            sidebarToggle.classList.remove('hidden');
        }
        
        if (sidebarToggle && sidebar && sidebarOverlay) {
            sidebarToggle.addEventListener('click', openSidebar);
            sidebarOverlay.addEventListener('click', closeSidebar);
        }
        
        // Modal de eliminación
        const modal = document.getElementById('modal-eliminar');
        const formEliminar = document.getElementById('form-eliminar');
        const btnCancelar = document.getElementById('btn-cancelar');
        
        function confirmarEliminar(id) {
            formEliminar.action = `/admin/reservas/${id}/eliminar`;
            modal.classList.remove('hidden');
        }
        
        if (btnCancelar) {
            btnCancelar.addEventListener('click', () => {
                modal.classList.add('hidden');
            });
        }
        
        // Cerrar modal eliminar al hacer clic fuera
        if (modal) {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.classList.add('hidden');
            });
        }

        // ========== MODAL DE REAGENDAR ==========
        const modalReagendar = document.getElementById('modal-reagendar');
        const formReagendar = document.getElementById('form-reagendar');
        const btnCancelarReagendar = document.getElementById('btn-cancelar-reagendar');
        const inputNuevaFecha = document.getElementById('nueva_fecha');
        const inputNuevaHora = document.getElementById('nueva_hora');
        const textoCliente = document.getElementById('reagendar-cliente');

        function abrirModalReagendar(id, fechaActual, horaActual, nombreCliente) {
            // Configurar el action del formulario
            formReagendar.action = `/admin/reservas/${id}/reagendar`;
            
            // Pre-llenar con los valores actuales
            inputNuevaFecha.value = fechaActual;
            inputNuevaHora.value = horaActual.substring(0, 5); // Tomar solo HH:MM
            
            // Mostrar nombre del cliente
            textoCliente.textContent = `Cliente: ${nombreCliente}`;
            
            // Establecer fecha mínima como hoy
            const hoy = new Date().toISOString().split('T')[0];
            inputNuevaFecha.min = hoy;
            
            // Mostrar modal
            modalReagendar.classList.remove('hidden');
        }

        if (btnCancelarReagendar) {
            btnCancelarReagendar.addEventListener('click', () => {
                modalReagendar.classList.add('hidden');
            });
        }

        // Cerrar modal reagendar al hacer clic fuera
        if (modalReagendar) {
            modalReagendar.addEventListener('click', (e) => {
                if (e.target === modalReagendar) modalReagendar.classList.add('hidden');
            });
        }

        // ========== MODAL DE OBSERVACIONES ==========
        const modalObservaciones = document.getElementById('modal-observaciones');
        const observacionesTexto = document.getElementById('observaciones-texto');
        const btnCerrarObs = document.getElementById('btn-cerrar-obs');

        function mostrarObservaciones(texto) {
            observacionesTexto.textContent = texto;
            modalObservaciones.classList.remove('hidden');
        }

        if (btnCerrarObs) {
            btnCerrarObs.addEventListener('click', () => {
                modalObservaciones.classList.add('hidden');
            });
        }

        // Cerrar modal observaciones al hacer clic fuera
        if (modalObservaciones) {
            modalObservaciones.addEventListener('click', (e) => {
                if (e.target === modalObservaciones) modalObservaciones.classList.add('hidden');
            });
        }

        // Cerrar todos los modales con Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                modal?.classList.add('hidden');
                modalReagendar?.classList.add('hidden');
                modalObservaciones?.classList.add('hidden');
            }
        });
