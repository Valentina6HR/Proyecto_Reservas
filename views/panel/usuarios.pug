extends ../layout/admin

block contenido
    .admin-panel-container.flex.min-h-screen.bg-crema
        
        //- Overlay para cerrar sidebar en móvil
        #sidebar-overlay.sidebar-overlay.hidden
        
        //- Botón hamburguesa para móviles (derecha)
        button#sidebar-toggle.sidebar-toggle.bg-vino.text-dorado.p-3.rounded-full.shadow-xl(class="lg:hidden")
            svg(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16")
        
        //- Sidebar izquierdo
        aside#sidebar.admin-sidebar.bg-vino.text-crema.flex.flex-col.shadow-2xl
            // Logo y título
            .sidebar-header.p-6.border-b-2.border-dorado
                h2.text-2xl.font-serif.font-bold.text-dorado Panel de Control
                p.text-sm.mt-2.opacity-90 #{usuario.nombre}
                p.text-xs.opacity-70.capitalize #{usuario.rol}
            
            //- Navegación
            nav.sidebar-nav.flex-1.p-4.space-y-2
                // Dashboard
                a.nav-item(href="/panel/admin")
                    svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                        path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6")
                    span Dashboard
                
                //- Reservas
                a.nav-item(href="/admin/reservas")
                    svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                        path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z")
                    span Gestionar Reservas
                
                //- Mesas (no para meseros)
                if usuario.rol !== "mesero"
                    a.nav-item(href="/mesas")
                        svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z")
                        span Gestión de Mesas
                
                //- Usuarios (solo admin)
                if usuario.rol === "admin"
                    a.nav-item.active(href="/admin/usuarios")
                        svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z")
                        span Usuarios del Sistema

                //- Reportes (solo admin)
                if usuario.rol === "admin"
                    a.nav-item(href="/admin/reportes")
                        svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                            path(path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m2 10V7m2 10V7m2 10h2a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2h2m4 2v2m3-2v2M9 13h3")
                        span Reportes

                //- Configuración (solo admin)
                if usuario.rol === "admin"
                    a.nav-item(href="/config")
                        svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z")
                            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z")
                        span Configuración
                
                //- Pagina principal
                a.nav-item(href="/")
                    svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                        path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7")
                    span Regresar a Inicio
            
            //- Footer del sidebar
            .sidebar-footer.p-4.border-t-2.border-dorado
                a.nav-item.logout(href="/auth/cerrar-sesion")
                    svg.nav-icon(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                        path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1")
                    span Cerrar Sesión
        
        //- Contenido principal
        main.admin-content.flex-1.p-8
            //- Encabezado
            .mb-8.flex.justify-between.items-center
                div
                    h1.text-4xl.font-serif.text-vino.font-bold.mb-2 Gestión de Usuarios
                    p.text-lg.text-gray-700 Administra los usuarios y sus roles
            
            //- Vista de tarjetas para móvil
            .mobile-cards-container.block(class="md:hidden")
                if usuarios.length
                    .grid.gap-4
                        each u in usuarios
                            .user-card.bg-white.rounded-xl.shadow-lg.p-4.border-l-4(
                                class=u.estado === 'activo' ? 'border-green-500' : 'border-red-500'
                            )
                                .flex.justify-between.items-start.mb-3
                                    .flex.items-center.gap-3
                                        .w-10.h-10.rounded-full.bg-gradient-to-br.from-vino.to-red-800.flex.items-center.justify-center
                                            span.text-white.font-bold.text-sm #{u.nombre.charAt(0).toUpperCase()}
                                        div
                                            h3.font-bold.text-gray-900 #{u.nombre}
                                            p.text-xs.text-gray-500 ID: ##{u.id}
                                    if u.estado === 'activo'
                                        span.px-2.py-1.text-xs.font-semibold.rounded-full.bg-green-100.text-green-800 Activo
                                    else
                                        span.px-2.py-1.text-xs.font-semibold.rounded-full.bg-red-100.text-red-800 Inactivo
                                
                                .space-y-2.text-sm
                                    .flex.items-center.gap-2.text-gray-600
                                        svg.w-4.h-4(xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor")
                                            path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z")
                                        span.truncate #{u.email}
                                    
                                    .flex.items-center.justify-between.pt-2.border-t.border-gray-100
                                        span.text-xs.text-gray-500 Rol:
                                        if u.id === usuario.id
                                            span.px-2.py-1.text-xs.font-semibold.rounded-full.bg-purple-100.text-purple-800 #{u.rol.toUpperCase()} (Tú)
                                        else
                                            form.rol-form(action=`/admin/usuarios/${u.id}/rol` method="POST")
                                                input(type="hidden" name="_csrf" value=csrfToken)
                                                select.rol-select.text-xs.font-semibold.rounded-lg.px-2.py-1.cursor-pointer.border-2.border-gray-200(name="rol" onchange="this.form.submit()")
                                                    option(value="cliente" selected=(u.rol === "cliente")) Usuario
                                                    option(value="recepcionista" selected=(u.rol === "recepcionista")) Recepcionista
                                                    if u.rol === 'admin'
                                                        option(value="admin" selected disabled) Admin
                                                    if u.rol === 'mesero'
                                                        option(value="mesero" selected disabled) Mesero
                else
                    .text-center.py-8.text-gray-500 No hay usuarios registrados

            //- Contenedor de la tabla (solo desktop)
            .bg-white.rounded-xl.shadow-xl.overflow-hidden.hidden(class="md:block")
                .overflow-x-auto
                    table.min-w-full.divide-y.divide-gray-200
                        thead.bg-gradient-vino.text-dorado
                            tr
                                th.px-6.py-4.text-left.text-xs.font-bold.uppercase.tracking-wider ID
                                th.px-6.py-4.text-left.text-xs.font-bold.uppercase.tracking-wider Nombre
                                th.px-6.py-4.text-left.text-xs.font-bold.uppercase.tracking-wider Email
                                th.px-6.py-4.text-left.text-xs.font-bold.uppercase.tracking-wider Rol
                                th.px-6.py-4.text-left.text-xs.font-bold.uppercase.tracking-wider Estado
                        
                        tbody.bg-white.divide-y.divide-gray-200
                            if usuarios.length
                                each u in usuarios
                                    tr.hover_bg-gray-50.transition-colors
                                        td.px-6.py-4.whitespace-nowrap.text-sm.font-medium.text-gray-900 ##{u.id}
                                        
                                        td.px-6.py-4.whitespace-nowrap.text-sm.text-gray-900 #{u.nombre}
                                        
                                        td.px-6.py-4.whitespace-nowrap.text-sm.text-gray-500 #{u.email}
                                        
                                        td.px-6.py-4.whitespace-nowrap
                                            if u.id === usuario.id
                                                span.px-2.inline-flex.text-xs.leading-5.font-semibold.rounded-full.bg-purple-100.text-purple-800 #{u.rol.toUpperCase()} (Tú)
                                            else
                                                form.rol-form(action=`/admin/usuarios/${u.id}/rol` method="POST")
                                                    input(type="hidden" name="_csrf" value=csrfToken)
                                                    select.rol-select.text-xs.font-semibold.rounded-lg.px-2.py-1.cursor-pointer(name="rol" onchange="this.form.submit()")
                                                        option(value="cliente" selected=(u.rol === "cliente"))  Usuario
                                                        option(value="recepcionista" selected=(u.rol === "recepcionista"))  Recepcionista
                                                        if u.rol === 'admin'
                                                            option(value="admin" selected disabled)  Admin
                                                        if u.rol === 'mesero'
                                                            option(value="mesero" selected disabled)  Mesero

                                        td.px-6.py-4.whitespace-nowrap
                                            if u.estado === 'activo'
                                                span.px-2.inline-flex.text-xs.leading-5.font-semibold.rounded-full.bg-green-100.text-green-800 Activo
                                            else
                                                span.px-2.inline-flex.text-xs.leading-5.font-semibold.rounded-full.bg-red-100.text-red-800 Inactivo

                            else
                                tr
                                    td.px-6.py-4.whitespace-nowrap.text-center.text-gray-500(colspan="5") No hay usuarios registrados

    style.
        /* Estilos reutilizados */
        .admin-panel-container { margin: 0; min-height: 100vh; }
        .admin-sidebar { width: 280px; position: fixed; left: 0; top: 0; height: 100vh; overflow-y: auto; z-index: 200; transform: translateX(-100%); transition: transform 0.3s ease; }
        .admin-sidebar.open { transform: translateX(0); }
        .sidebar-header { background: linear-gradient(135deg, #6E1825 0%, #8B2030 100%); }
        .nav-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; border-radius: 0.5rem; color: #F2EADF; font-weight: 500; transition: all 0.3s ease; cursor: pointer; }
        .nav-item:hover { background: rgba(199, 168, 108, 0.15); transform: translateX(4px); color: #C7A86C; }
        .nav-item.active { background: linear-gradient(90deg, rgba(199, 168, 108, 0.2) 0%, rgba(199, 168, 108, 0.05) 100%); border-left: 3px solid #C7A86C; color: #C7A86C; }
        .nav-icon { width: 1.5rem; height: 1.5rem; flex-shrink: 0; }
        .admin-content { margin-left: 0; min-height: 100vh; padding-top: 4rem; }
        .bg-gradient-vino { background: linear-gradient(135deg, #6E1825 0%, #8B2030 100%); }
        
        /* Botón hamburguesa a la derecha */
        .sidebar-toggle { 
            position: fixed; 
            top: 1rem; 
            right: 1rem; 
            z-index: 150; 
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .sidebar-toggle.hidden { 
            opacity: 0; 
            pointer-events: none; 
            transform: scale(0.8);
        }
        
        /* Overlay para cerrar sidebar */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 150;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        .sidebar-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        .sidebar-overlay.hidden { display: none; }
        
        /* Tarjetas de usuario en móvil */
        .user-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .user-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Select de rol */
        .rol-select {
            border: 2px solid #e5e7eb;
            background-color: white;
            transition: all 0.2s ease;
        }
        .rol-select:hover {
            border-color: #C7A86C;
        }
        .rol-select:focus {
            outline: none;
            border-color: #6E1825;
            box-shadow: 0 0 0 3px rgba(110, 24, 37, 0.1);
        }
        
        @media (min-width: 769px) {
            .admin-sidebar { transform: translateX(0); }
            .admin-content { margin-left: 280px; padding-top: 0; }
            .sidebar-toggle { display: none; }
            .sidebar-overlay { display: none; }
        }

    script.
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        
        function openSidebar() {
            sidebar.classList.add('open');
            sidebarOverlay.classList.remove('hidden');
            sidebarOverlay.classList.add('active');
            sidebarToggle.classList.add('hidden');
        }
        
        function closeSidebar() {
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('active');
            setTimeout(() => sidebarOverlay.classList.add('hidden'), 300);
            sidebarToggle.classList.remove('hidden');
        }
        
        if (sidebarToggle && sidebar && sidebarOverlay) {
            sidebarToggle.addEventListener('click', openSidebar);
            sidebarOverlay.addEventListener('click', closeSidebar);
        }
